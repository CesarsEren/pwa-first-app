<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta property="og:title" content="Carta Don Frito" />
    <meta property="og:description"
        content="En Don Frito encontrar√°s los mejores s√°ndwiches, pollos broaster y salchipapas de la mejor calidad y hechos en casa. Con √≥ptimos insumos y la inigualable saz√≥n peruana." />
    <meta name="description"
        content="En Don Frito encontrar√°s los mejores s√°ndwiches, pollos broaster y salchipapas de la mejor calidad y hechos en casa. Con √≥ptimos insumos y la inigualable saz√≥n peruana." />
    <meta property="og:image" content="https://donfrito.conmicarta.com/images/app-icon.png" />
    <meta property="og:url" content="https://donfrito.conmicarta.com/" />
    <meta property="og:type" content="image.png" />

    <title>Don Frito</title>


    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/css/now-ui-kit.css?v=1.2.0" rel="stylesheet" />
    <link href="/assets/fontawesome/all.min.css" rel="stylesheet" />
    <link href="/assets/fontawesome/fontawesome.min.css" rel="stylesheet" />

    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico">
    <meta name="theme-color" content="#3f51b5">


    <style>
        /* width */
        ::-webkit-scrollbar {
            width: 10px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #888;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        #powerby p {
            line-height: 20px;
        }

        .horario {
            font-weight: bold;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        @media (max-width:600px) {
            .horario {
                font-size: 24px;
            }
        }

        a {
            color: white;
        }

        .footer {
            padding-bottom: 100px !important;
        }

        .bg-cesars {
            background: radial-gradient(#b000 15%, transparent 16%) 0 0,
                radial-gradient(#a000 15%, transparent 16%) 8px 8px,
                radial-gradient(rgba(207, 204, 204, 0.712) 15%, transparent 20%) 0 1px,
                radial-gradient(rgba(40, 40, 40, 0.3) 15%, transparent 20%) 8px 9px;
            background-color: white;
            background-size: 5px 5px;
        }
    </style>

</head>


<body class="bg-cesars">

    <nav class="navbar navbar-expand-lg   bg-warning p-1 sticky-top">

        <div class="container">
            <div class="navbar-brand d-flex align-items-center" href="#">
                <img src="" alt="" id="logoemp" style="border-radius: 20px;" width="60px" height="60px">
                <div class=" d-flex flex-column  ">
                    <!--h4 class="mt-0 mb-0 text-light ml-2  " id="nombrealmacen">Empresa</h4-->
                    <h4 class="mt-0 mb-0 text-light ml-2  " id="nombrealmacen">Don Frito</h4>
                    <!--p class="text-light ml-2 mt-1 text-muted  " id="rubro" style="margin-top:-10px;"></p-->
                    <p class="text-light ml-2 mt-1 text-muted  " style="margin-top:-10px;">Comida r√°pida</p>
                </div>
            </div>
            <a class="btn btn-sm btn-outline-light my-2 pr-3 pl-3 pt-2 pb-2 my-sm-0" id="pdfurl" href="">Cat√°logo de
                Productos</a>
            <!--target="_blank"-->
        </div>

    </nav>

    <main role="main">
        <div class="container">
            <div class="row pb-3">
                <div class="col-md-8  m-auto">
                    <div class="d-flex justify-content-between">
                        <div class="col-xs">
                            <a id="pdfurlarrrow" href="">
                                <i class="fas fa-lg mt-2 fa-arrow-left float-left text-dark"></i>
                            </a>
                        </div>
                        <div class="col-xs">
                            <h6 class="text-center mt-2 text-dark h6 "><strong>Tu pedido</strong></h6>
                        </div>
                        <div class="col-xs">
                            <a href="javascript:void(0)" onclick="limpiarcarrito()">
                                <i class="fas fa-lg mt-2 fa-trash  text-dark "></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <section id="listaproductos">
            </section>
        </div>

        </div>
        </div>

    </main>

    <div class="fixed-bottom">
        <div class="row p-4 bg-warning">
            <div class="container text-center">
                <!--<a class="btn btn-sm btn-outline-light my-2 pr-3 pl-3 pt-2 pb-2 my-sm-0" href="">Volver al cat√°logo</a>-->
                <a class="btn  btn-success my-2 pr-5 pl-5 pt-3 pb-3 my-sm-0" id="btnopenmodal">
                    <!--data-toggle="modal" data-target="#exampleModalCenter"-->
                    <i class="fab fa-whatsapp"></i>
                    Enviar Pedido por WhatsApp |
                    S/<span id="preciototal"> </span>
                </a>
            </div>
        </div>
    </div>

    <footer class="footer mb-5 bg-warning pl-5 pr-5 pt-3 pb-5">
        <div class="row">
            <div class="container">
                <div class="col-md-8  m-auto pt-3">
                    <div class="row  ">
                        <div class="col-8">
                            <h5 class="text-white font-weight-bold">Horario de Atenci√≥n:</h5>
                            <p class="text-white text-bold horario" id="txthorario">Lunes a Viernes a 9:00 am a 22:00 pm
                            </p>
                        </div>
                        <div class="col-4 ">
                            <div class="text-right">
                                <div class="d-flex flex-column">
                                    <a id="facebook" class="text-white a  m-2" target="_blank" href="">
                                        <i class="fab fa-2x fa-facebook"></i>
                                    </a>
                                    <a id="tiktok" class="text-white a m-2" target="_blank" href="">
                                        <i class="fab fa-2x fa-tiktok"></i>
                                    </a> <a id="instagram" class="text-white a  m-2" target="_blank" href="">
                                        <i class="fab fa-2x  fa-instagram"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row  ">
                        <div class="col-12">
                            <p class="mt-4 text-white" id="powerby"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>



    <!-- Modal -->
    <div class="modal fade" id="modalatributos" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true" data-keyboard="false" data-backdrop="static">
        <!--data-keyboard="false" data-backdrop="static"-->
        <div class="modal-dialog  modal-dialog-centered" role="document">
            <!--modal-dialog-centered-->
            <div class="modal-content ">
                <div class="modal-header">
                    <h5 class="modal-title text-center">¬øC√≥mo lo quiere?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <img src="" height="100%" width="100%" id="imageselect" alt="">
                    <div class="form-group" id="preciodefault">
                    </div>
                    <div class="form-group" id="nombreproducto">
                    </div>

                    <hr>
                    <div id="sectionatributos">

                    </div>
                </div>
                <!--p class="text-center">Que disfrutes tu pedido <br>
                    ¬°Gracias por Elegirnos!</p-->

            </div>
        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="modalcomplementos" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar complemento</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="sectioncomplementos">

                    </div>
                </div>
                <!--p class="text-center">Que disfrutes tu pedido <br>
                    ¬°Gracias por Elegirnos!</p-->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalenviar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Datos para Env√≠o</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="cambiomodal">
                    <p class="card-text text-dark text-center ">El pedido llegar√° directamente a tu WhatsApp</p>

                    <ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation" onclick="ocultarbtnwhatsapp('local')">
                            <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home"
                                role="tab" aria-controls="pills-home" aria-selected="true">Consumo en Local</a>
                        </li>
                        <li class="nav-item" role="presentation" onclick="ocultarbtnwhatsapp('delivery')">
                            <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile"
                                role="tab" aria-controls="pills-profile" aria-selected="false">Delivery</a>
                        </li>
                    </ul>

                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-home" role="tabpanel"
                            aria-labelledby="pills-home-tab">
                            <form method="POST">
                                <div class="form-group">
                                    <label for="nombrelocal">üë§ Nombre</label>
                                    <input type="text" name="nombrelocal" id="nombrelocal" class="form-control"
                                        placeholder="Ingrese nombre " onkeyup="actualizarurlwhatsapplocal()" autofocus>
                                </div>
                                <div class="form-group">
                                    <label for="mesalocal">üçΩÔ∏è Nro Mesa</label>
                                    <input type="text" name="mesalocal" id="mesalocal" class="form-control"
                                        placeholder="Ingrese Nro de Mesa " onkeyup="actualizarurlwhatsapplocal()"
                                        autofocus>
                                </div>
                                <div class="form-group">
                                    <label for="comentariolocal">üí¨ Comentario</label>
                                    <textarea name="comentariolocal" id="comentariolocal" rows="2" class="form-control"
                                        placeholder="Comentario para entrega"
                                        onkeyup="actualizarurlwhatsapplocal()"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="pills-profile" role="tabpanel"
                            aria-labelledby="pills-profile-tab">
                            <form method="POST">
                                <div class="form-group">
                                    <label for="nombre">üë§ Nombre</label>
                                    <input type="text" name="nombre" id="nombre" class="form-control"
                                        placeholder="Ingrese nombre " onkeyup="actualizarprecioconformaentrega()"
                                        autofocus>
                                </div>
                                <div class="form-group">
                                    <label for="direccion">üìç Direcci√≥n</label>
                                    <input type="text" name="direccion" id="direccion" class="form-control"
                                        placeholder="Ingrese direcci√≥n " onkeyup="actualizarprecioconformaentrega()"
                                        autofocus>
                                </div>
                                <div class="form-group">
                                    <label for="comentario">üí¨ Comentario</label>
                                    <textarea name="comentario" id="comentario" rows="2" class="form-control"
                                        placeholder="Comentario para entrega"
                                        onkeyup="actualizarprecioconformaentrega()"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="slcformaentrega">üõí Seleccione Forma de Entrega</label>
                                    <select class="w-80 form-control custom-select bg-dark text-white"
                                        id="slcformaentrega" onchange="actualizarprecioconformaentrega()">
                                    </select>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <p class="text-center">Que disfrutes tu pedido <br>
                    ¬°Gracias por Elegirnos!</p>
                <div class="modal-footer" id="verbottom" style="display: none">
                    <a class="text-center m-auto btn  btn-success my-2 pr-5 pl-5 pt-3 pb-3 my-sm-0" href=""
                        target="_blank" id="btnwhatsapp"><i class="fab fa-whatsapp"></i> Enviar Pedido S/<span
                            id="preciototalforma"></span></a>
                </div>


            </div>
        </div>
    </div>
    <script src="js/app.js"></script>
    <script src="../assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="../assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="../assets/js/core/bootstrap.min.js" type="text/javascript"></script>

    <script src="../assets/js/plugins/bootstrap-switch.js"></script>

    <script src="../assets/js/plugins/nouislider.min.js" type="text/javascript"></script>

    <script src="../assets/js/plugins/bootstrap-datepicker.js" type="text/javascript"></script>

    <script src="../assets/js/now-ui-kit.js?v=1.2.0" type="text/javascript"></script>

    <script>
        var pintadodecomplementos = function (posicioncarrito) {

            var carrito = JSON.parse(localStorage.carrito);
            var item = carrito[posicioncarrito];
            var html = "";
            if (carrito[posicioncarrito].complementosadded.length > 0) {

                for (const [i, complemento] of carrito[posicioncarrito].complementosadded.entries()) {
                    html += `<div class = "w-100 mt-2 d-flex justify-content-between">
                <strong class="d-flex align-self-center">
                ${complemento.complemento_nombre}
                S / ${parseFloat(complemento.detalle_complemento_precio).toFixed(2)} 
                </strong>
                <div>
                <div class="d-flex justify-content-end" >
                <a  onclick="lesscomplementoslista(${posicioncarrito},${complemento.detalle_complemento_id})" style="width:40px;height:40px;border-radius:0px;border-top-left-radius:5px;border-bottom-left-radius:5px;" class = "btn btn-dark btn-sm" >
                <i class="mt-2 fas fa-minus"> </i> </a> 
                <input disabled value="${complemento.contador}"class = "m-auto form-control text-white text-center" style="border:none;border-radius:0px;width:40px;height:40px;background-color:#1D2124" type="text"  />
                <a onclick="addcomplementoslista(${posicioncarrito},${complemento.detalle_complemento_id})" style="width:40px;height:40px;border-radius:0px;border-top-right-radius:5px;border-bottom-right-radius:5px;"class="btn btn-dark btn-sm">
                <i class="mt-2 fas fa-plus" > </i> 
                </a> </div> 
                </div> 
                </div>`;
                }
            }
            $("#seccioncomplementos" + posicioncarrito).html(html);
        }
        var limpiarcarrito = function () {
            var carrito = [];
            localStorage.contador = 0;
            localStorage.carrito = JSON.stringify(carrito);
            $("#listaproductos").html("");
            actualizarbtnwhatsaap();
        }
        var ocultarbtnwhatsapp = function (tipo) {
            $("#nombrelocal").val("");
            $("#mesalocal").val("");
            $("#comentariolocal").val("");
            $("#verbottom").css("display", "none");
        }

        var actualizarurlwhatsapplocal = function () {

            if ($("#nombrelocal").val().trim().length > 0 && $("#mesalocal").val().trim().length > 0) {
                $("#verbottom").css("display", "");

                var carrito = JSON.parse(localStorage.carrito);
                var NOMBRE = $("#nombrelocal").val();
                var MESA = $("#mesalocal").val();
                var COMENTARIO = $("#comentariolocal").val();
                var ENTER = "%0A";
                var PEDIDO = `${ENTER}`;

                var preciototal = 0;
                for (_itemcart of carrito) {
                    var attrsubtotal = 0;
                    if (_itemcart.activo) {
                        var ATRIBUTO = ""; //`${ENTER}`;
                        if (_itemcart.atributo != -2) {
                            var getatributo = _itemcart.atributos.find(_atributo => parseInt(_atributo.detalle_atributo_id) === _itemcart.atributo);
                            //attrsubtotal = getatributo.atributo_precio * _itemcart.cantidad;
                            ATRIBUTO += `${getatributo.atributo_nombre}  `;
                            //| S/${getatributo.atributo_precio} ${ENTER}`;
                        } else {
                            ATRIBUTO += ""; // `predeterminado`;
                        }
                        var COMPLEMENTOS = `${ENTER} *Complementos*`;
                        var preciocomp = 0;
                        for (comp of _itemcart.complementosadded) {
                            if (comp.contador != 0) {
                                COMPLEMENTOS += `${ENTER} ${comp.complemento_nombre} -> S/ ${parseFloat(comp.detalle_complemento_precio).toFixed(2)} x ${comp.contador}  `;
                                preciocomp += parseInt(comp.contador) * parseFloat(comp.detalle_complemento_precio).toFixed(2);
                            }
                        }

                        PEDIDO += `*${_itemcart.titulo} | ${ATRIBUTO} -> S/${_itemcart.precio} x ${_itemcart.cantidad}*   ${COMPLEMENTOS !== "" ? ` ${COMPLEMENTOS}` : ''} 
                        ${ENTER}*Aclaraciones :* ${_itemcart.declaracion}  
                        ${ENTER}*Subtotal: S/${parseFloat((_itemcart.cantidad * parseFloat(_itemcart.precio)) + preciocomp).toFixed(2)}* 
                        ${ENTER}==========
                        ${ENTER}`;

                        preciototal += (_itemcart.cantidad * parseFloat(_itemcart.precio)) + preciocomp;
                    }
                }

                var MENSAJE = localStorage.almacen_mensaje;
                urlwhatsapp = `https://api.whatsapp.com/send?phone=${localStorage.whatsapp}&text=` +
                    `üë§ *Nombre :*${ENTER}` +
                    `${NOMBRE}${ENTER}${ENTER}` +
                    `üçΩÔ∏è *Nro de Mesa :*${ENTER}` +
                    `${MESA}${ENTER}${ENTER}` +
                    `üí¨ *Comentario :*${ENTER}` +
                    `${COMENTARIO}${ENTER}${ENTER}` +
                    `*Pedido :*${ENTER}` +
                    `${PEDIDO}` +

                    `${ENTER}${ENTER}` +
                    `*Precio Total :*${ENTER}` +
                    `üëâüèª_*S/ ${parseFloat(preciototal).toFixed(2)}*_${ENTER}` +
                    `_*CONSUMO EN LOCAL*_${ENTER}${ENTER}` +
                    `${MENSAJE}`;

                $("#btnwhatsapp").attr("href", urlwhatsapp);

            }
        }

        var actualizarurlwhatsapp = function () {
            var carrito = JSON.parse(localStorage.carrito);
            var NOMBRE = $("#nombre").val();
            var DIRECCION = $("#direccion").val();
            var COMENTARIO = $("#comentario").val();
            var FORMAENTREGA = $("#slcformaentrega option:selected").text();
            var PRECIOTOTALFORMA = $("#preciototalforma").text();
            var ENTER = "%0A";
            var PEDIDO = `${ENTER}`;
            var _itemcart = null;
            for (_itemcart of carrito) {
                var attrsubtotal = 0;
                if (_itemcart.activo) {
                    var ATRIBUTO = ""; //`${ENTER}`;
                    if (_itemcart.atributo != -2) {
                        var getatributo = _itemcart.atributos.find(_atributo => parseInt(_atributo.detalle_atributo_id) === _itemcart.atributo);
                        //attrsubtotal = getatributo.atributo_precio * _itemcart.cantidad;
                        ATRIBUTO += `${getatributo.atributo_nombre}  `;
                        //| S/${getatributo.atributo_precio} ${ENTER}`;
                    } else {
                        ATRIBUTO += ""; // `predeterminado`;
                    }
                    var COMPLEMENTOS = `${ENTER} *Complementos*`;
                    var preciocomp = 0;
                    for (comp of _itemcart.complementosadded) {
                        if (comp.contador != 0) {
                            COMPLEMENTOS += `${ENTER} ${comp.complemento_nombre} -> S/ ${parseFloat(comp.detalle_complemento_precio).toFixed(2)} x ${comp.contador}  `;
                            preciocomp += parseInt(comp.contador) * parseFloat(comp.detalle_complemento_precio).toFixed(2);
                        }
                    }

                    PEDIDO += `*${_itemcart.titulo} | ${ATRIBUTO} -> S/${_itemcart.precio} x ${_itemcart.cantidad}*   ${COMPLEMENTOS !== "" ? ` ${COMPLEMENTOS}` : ''} 
                        ${ENTER}*Aclaraciones :* ${_itemcart.declaracion}  
                        ${ENTER}*Subtotal: S/${parseFloat((_itemcart.cantidad * parseFloat(_itemcart.precio)) + preciocomp).toFixed(2)}* 
                        ${ENTER}==========
                        ${ENTER}`;

                    preciototal += (_itemcart.cantidad * parseFloat(_itemcart.precio)) + preciocomp;
                }
            }

            /*for (_itemcart of carrito) {
                var attrsubtotal = 0;
                if (_itemcart.activo) {
                    var ATRIBUTO = `${ENTER}`;
                    if (_itemcart.atributo != -1) {
                        var getatributo = _itemcart.atributos.find(_atributo => parseInt(_atributo.detalle_atributo_id) === _itemcart.atributo);
                        attrsubtotal = getatributo.atributo_precio * _itemcart.cantidad;
                        ATRIBUTO += `${getatributo.atributo_nombre}  | S/${getatributo.atributo_precio} por unidad ${ENTER}`;
                    }
                    var COMPLEMENTOS = "";
                    var preciocomp = 0;
                    for (comp of _itemcart.complementosadded) {
                        if (comp.contador != 0) {
                            COMPLEMENTOS += `${ENTER} ${comp.complemento_nombre} -> S/ ${parseFloat(comp.detalle_complemento_precio).toFixed(2)} x ${comp.contador}  `;
                            preciocomp = comp.contador * parseFloat(comp.detalle_complemento_precio).toFixed(2);
                        }
                    }
                    PEDIDO += `*${_itemcart.titulo} -> S/${_itemcart.precio}* ${ATRIBUTO}  _${_itemcart.cantidad} unidades_   ${COMPLEMENTOS!==""?` ${COMPLEMENTOS}`:''} ${ENTER}*Aclaraciones :* ${_itemcart.declaracion} ${ENTER}*Subtotal: S/${((_itemcart.cantidad*_itemcart.precio)+attrsubtotal)+preciocomp}* ${ENTER}`;
                }
            }-*/

            var MENSAJE = localStorage.almacen_mensaje;
            urlwhatsapp = `https://api.whatsapp.com/send?phone=${localStorage.whatsapp}&text=` +
                `üë§ *Nombre :*${ENTER}` +
                `${NOMBRE}${ENTER}${ENTER}` +
                `üìç *Direcci√≥n :*${ENTER}` +
                `${DIRECCION}${ENTER}${ENTER}` +
                `üõí *Forma de Entrega :*${ENTER}` +
                `${FORMAENTREGA}${ENTER}${ENTER}` +
                `üí¨ *Comentario :*${ENTER}` +
                `${COMENTARIO}${ENTER}${ENTER}` +
                `*Pedido :*${ENTER}` +
                `${PEDIDO}${ENTER}` +
                `*Precio Total :*${ENTER}` +
                `üëâüèª_*S/${PRECIOTOTALFORMA}*_${ENTER}${ENTER}` +
                `${MENSAJE}`;

            $("#btnwhatsapp").attr("href", urlwhatsapp);
        }
        $("#btnopenmodal").click(function () {
            $("#verbottom").css("display", "none");
            actualizarbtnwhatsaap();
            $("#slcformaentrega").val(-1);
            $("#modalenviar").modal("show");
            actualizarurlwhatsapp();
        });

        var contador = 0;
        var item = {
            "idunico": 0,
            "titulo": "",
            "cantidad": 1,
            "precio": 000,
            "preciodefault": 000,
            "atributo": 0,
            "declaracion": "",
            "img": "",
            "atributos": [],
            "complementos": [],
            "complementosadded": [],
            "activo": true,
            "posicion": 0
        };

        var carrito = [];
        var html = "";

        var itemcart = function (data) {
            console.log(data);
            var select = "";
            var option = "";
            var preciocomp = 0;
            //var precioattr = 0;
            var _flagattr = false;

            if (data.complementosadded.length > 0) {
                for (foo of data.complementosadded) {
                    preciocomp += parseFloat(foo.detalle_complemento_precio) * foo.contador;
                }
            }

            if (data.atributos.length > 0) {
                //option += `<option data-price="0.00" value="-1" disabled selected>Seleccione ${data.atributos[0].atributo_nombre}</option>`;
                //option += `<option data-price="${data.preciodefault}" value="-1" disabled selected>Seleccione Atributo</option>`;
                var predeterminado = data.atributo == -2;
                option += ""; // `<option data-price="${data.preciodefault}" ${predeterminado?'selected':''} value="-2">Precio predeterminado |${data.preciodefault}</option>`;
                for (foo of data.atributos) {
                    if (data.atributo == parseInt(foo.detalle_atributo_id) && predeterminado == false) {
                        //precioattr = foo.atributo_precio * data.cantidad;
                        _flagattr = true;
                    }
                    option += `<option data-price="${foo.atributo_precio}" ${_flagattr ? 'selected' : ''}   value="${foo.detalle_atributo_id}">${foo.atributo_nombre} | S/ ${foo.atributo_precio}</option>`;
                    _flagattr = false;
                }
                select = `<select class="w-80  p-2 form-control custom-select bg-success text-white" id="itemselect${data.posicion}" style="border-radius: 5px;"  onchange="cambiarselect(${data.posicion})" >
                            ${option}
                        </select>`;
            }

            var response = `<div id="card${data.posicion}"class="p-2 col-sm-12 col-md-8 ml-auto mr-auto  capa rounded">
                <section  id="cardbg${data.posicion}" class="p-3 card ${data.activo ? 'bg-dark' : 'bg-ligth'}">
                    <article class=" m-2 d-flex justify-content-between">
                        <div style="width:40%" class="font-weight-bold  text-dark">
                            <h5 class="h6 font-weight-bold">${data.titulo}</h5>
                            <p><span id="cantidad${data.posicion}">${data.cantidad}</span> unidades</p>
                        </div>
                        <div style="width:60%">
                            <img style="cursor:pointer;float:right;margin-bottom:5px;width:70%;border:1px solid grey;border-radius: 10px;" src="${data.img}" alt="" onclick="openimageinmodal(event)">
                            <span class="text-dark font-weight-bold float-right mr-2">S/<span id="precio${data.posicion}">${parseFloat(data.precio).toFixed(2)}</span></span>
                        </div>
                    </article>
                    <article class=" m-2">
                        <div class=" d-flex  align-self-end justify-content-between ">
                            <div>
                            
                                <p class="h5 font-weight-bold text-dark" id="subtotal${data.posicion}">S/${parseFloat((data.precio * data.cantidad) + (preciocomp)).toFixed(2)}</p>
                            </div>
                            <div class="d-flex justify-content-end">
                                <a onclick="less(${data.posicion})" style="width:40px;height:40px;border-radius:0px;border-top-left-radius:5px;border-bottom-left-radius:5px;" class="btn btn-dark btn-sm">
                                    <i class="mt-2 fas fa-minus"></i>
                                </a>
                                <input id="incantidad${data.posicion}" disabled value="${data.cantidad}" class="m-auto form-control text-white text-center " style="border:none;border-radius:0px;width:40px;height:40px;background-color:#1D2124" type="text" name="" id="">
                                <a onclick="add(${data.posicion})" style="width:40px;height:40px;border-radius:0px;border-top-right-radius:5px;border-bottom-right-radius:5px;" class="btn btn-dark btn-sm">
                                    <i class="mt-2 fas fa-plus"></i>
                                </a>
                            </div>
                        </div>
                    </article> 
                    <article>
                    ${data.complementos.length > 0 ? `
                        <hr>
                    <article>
                    <button  
                    onclick="modalcomplementos(${data.posicion})"class="float-right mr-2 btn btn-warning" >A√±adir complemento</button>
                    </article>
                    <br>
                    <br>
                    `
                    : ''}
                    
                    <article class="mt-4 mr-2 ml-2 text-dark" id="seccioncomplementos${data.posicion}">
                    
                    <hr></article>
                    <hr>
            <article class="m-2 ">
                <div class="form-group">
                        ${select}
                        <input placeholder="Agregar aclaraciones" style="border-radius: 5px;" class=" p-2 mt-2 form-control bg-light" type="text" name="" id="declaraciones${data.posicion}" onblur="llenardeclaracion(${data.posicion})" value="${data.declaracion}">
                        </div>
                    </article>                    
                </section>
            </div>`;

            return response;
        }

        var cambiarselect = function (posicion_carrito) {
            var id = posicion_carrito;

            var carrito = JSON.parse(localStorage.carrito);
            var itemattr = $("#itemselect" + id).val();
            var precioattr = $("#itemselect" + id + " option:selected").data("price");
            var _itemcarrit = carrito[id];
            _itemcarrit.precio = parseFloat(precioattr);
            _itemcarrit.atributo = parseInt(itemattr);

            var preciocomp = getPriceOfComplements(_itemcarrit);
            //var precioattr ;
            //= getPriceOfAttributes(_itemcarrit);

            $("#precio" + id).text(parseFloat(_itemcarrit.precio).toFixed(2));
            $("#subtotal" + id).text(" S/" +
                (parseFloat(_itemcarrit.cantidad * _itemcarrit.precio) + parseFloat(preciocomp)).toFixed(2)
            );

            //carrito[id].atributo = parseInt(itemattr);
            localStorage.carrito = JSON.stringify(carrito);

            actualizarbtnwhatsaap();
        }
        var llenardeclaracion = function (id) {
            carrito = JSON.parse(localStorage.carrito);
            carrito[id].declaracion = $("#declaraciones" + id).val();
            localStorage.carrito = JSON.stringify(carrito);
        }

        var add = function (posicion_carrito) {
            var id = posicion_carrito;
            var carrito = JSON.parse(localStorage.carrito);
            carrito[id].activo = true;
            var cantidad = carrito[id].cantidad;
            cantidad++;
            $("#incantidad" + id).val(cantidad)
            $("#cantidad" + id).text(cantidad)
            carrito[id].cantidad = cantidad;
            var precio = parseFloat(carrito[id].precio);
            var preciocomp = getPriceOfComplements(carrito[id]);
            //var precioattr = getPriceOfAttributes(carrito[id]);
            $("#subtotal" + id).text(" S/" + parseFloat((precio * cantidad) + (parseFloat(preciocomp))).toFixed(2));
            $("#cardbg" + id).removeClass("bg-ligth").addClass("bg-dark");
            localStorage.carrito = JSON.stringify(carrito);
            actualizarbtnwhatsaap();
        }



        var less = function (posicion_carrito) {
            var id = posicion_carrito;
            var carrito = JSON.parse(localStorage.carrito);
            var cantidad = parseFloat($("#incantidad" + id).val());
            if (cantidad != 0) {
                cantidad--;
                carrito[id].cantidad = cantidad;
            }
            var preciocomp = getPriceOfComplements(carrito[id]);
            //var precioattrs = getPriceOfAttributes(carrito[id]);
            var precio = parseFloat(carrito[id].precio);
            if (cantidad == 0) {
                carrito[id].activo = false;
                $("#cardbg" + id).removeClass("bg-dark").addClass("bg-ligth");
                preciocomp = 0;
                //precioattrs = 0;
            } else {
                $("#cardbg" + id).removeClass("bg-ligth").addClass("bg-dark");
            }
            $("#incantidad" + id).val(cantidad)
            $("#cantidad" + id).text(cantidad)
            $("#subtotal" + id).text(" S/" + parseFloat((precio * cantidad) + (parseFloat(preciocomp))).toFixed(2));
            localStorage.carrito = JSON.stringify(carrito);
            actualizarbtnwhatsaap();
        }

        var actualizarbtnwhatsaap = function () {
            var carrito = JSON.parse(localStorage.carrito);
            var preciototal = 0.00;
            var _item;
            for (_item of carrito) {
                var auxitem = _item;
                var preciocomp = 0;
                if (_item.complementosadded.length > 0 && _item.cantidad > 0) {
                    for (item of _item.complementosadded) {
                        preciocomp += item.detalle_complemento_precio * item.contador;
                    }
                }
                /*if (_item.atributo != -2 && _item.activo == true) {
                    var getatributo = _item.atributos.find(_atributo => parseInt(_atributo.detalle_atributo_id) === _item.atributo);
                    auxitem.atributos = [];
                    auxitem.atributos.push(getatributo);
                    preciototal += parseFloat(getatributo.atributo_precio * _item.cantidad);
                }*/
                preciototal += (_item.precio * _item.cantidad) + preciocomp;
            }
            $("#preciototal").text(parseFloat(preciototal).toFixed(2));
            $("#preciototalforma").text(parseFloat(preciototal).toFixed(2));
        }
        var carritowhatsapp = [];

        var pintarcarrito = function () {
            var cart = JSON.parse(localStorage.carrito);
            var html = "";
            for (foo of cart) {
                if (foo.cantidad > 0) {
                    foo.activo = true;
                }
                html += itemcart(foo);
            }
            $("#listaproductos").html(html);
            for (foo of cart) {
                pintadodecomplementos(foo.posicion);
            }
        }
        var attr
        $(document).ready(function () {
            $('#myTab a').on('click', function (e) {
                e.preventDefault()
                $(this).tab('show')
            })

            let params = new URLSearchParams(window.location.search);
            var id = params.get("producto");
            var urlattr = params.get("attr");
            attr = urlattr == null ? -1 : parseFloat(urlattr);
            verificarcontador();

            $("#txthorario").html(localStorage.almacen_horario);
            $("#facebook").attr("href", localStorage.almacen_facebook);
            $("#tiktok").attr("href", localStorage.almacen_tiktok);
            $("#instagram").attr("href", localStorage.almacen_instagram);
            $("#powerby").html(localStorage.footer_empresa);
            $("#logoemp").attr("src", localStorage.almacen_logo);
            $("#nombrealmacen").html(localStorage.almacen);

            $("#rubro").text(localStorage.almacen_rubro);

            $("#pdfurl").attr("href", localStorage.almacen_url_pdf);
            $("#pdfurlarrrow").attr("href", localStorage.almacen_url_pdf);

            if (localStorage.carrito != null) {
                carrito = JSON.parse(localStorage.carrito);
            }
            $("#verbottom").css("display", "none");
            $.ajax({
                type: "GET",
                url: "https://tablerodonfrito.herokuapp.com/consulta_producto.php?id=" + id,
                dataType: 'json',
                success: function (result) {
                    if (result.producto != null) {
                        //var producto = result.producto;
                        if (localStorage.carrito != null) {
                            llenarformasentregaactl(result.entrega);
                            pintarcarrito();
                            actualizarbtnwhatsaap();
                        }
                        verificarAtributo(result)
                    } else {
                        console.log("Producto no encontrado")
                        llenarformasentrega();
                        pintarcarrito();
                        actualizarbtnwhatsaap();
                    }
                }
            });

        });
        var ElegirPrecioAtributo = function (attr) {
            //resultajax
            //console.log(resultajax)
            var producto = resultajax.producto;
            $("#modalatributos").modal("hide");
            //console.log(producto);
            seteodeItems(producto, attr);
            condicionparallenadodeLocalStorage(resultajax);
            llenarformasentrega();
            pintarcarrito();
            actualizarbtnwhatsaap();
        }
        var resultajax = null;
        var verificarAtributo = function (data) {
            resultajax = data;

            var result = data;
            var itemcart = result.producto;
            console.log(itemcart);
            //var carrito = JSON.parse(localStorage.carrito);
            var html = "";
            //atributo_nombre
            if (itemcart.atributos.length > 0) {
                for (const [i, atributo] of itemcart.atributos.entries()) {
                    html += `<article  onclick="ElegirPrecioAtributo(${atributo.detalle_atributo_id})" class="w-100 btn btn-secondary mt-2 d-flex justify-content-between">
                <span >
                ${atributo.atributo_nombre} 
                </span>
                <span >S/${atributo.atributo_precio}
                </span>
               
                </article>`;
                }
                $("#modalatributos").modal("show");
            } else {
                ElegirPrecioAtributo(-2);
            }

            var whenpreciodefault = -2;

            $("#nombreproducto").html(
                `<article  class="w-100 mt-2 d-flex">
                    <span class="m-auto font-weight-bold text-dark "> ${itemcart.nombre_producto}</span>
                </article>`);

            $("#imageselect").attr("src", itemcart.imagen_producto);
            $("#sectionatributos").html(html);

        }


        var getPriceOfComplements = function (itemcart) {
            var response = 0;
            itemcart.complementosadded.forEach(item => {
                response += parseFloat(item.detalle_complemento_precio) * item.contador;
            });
            return parseFloat(response).toFixed(2);
        };

        /*var getPriceOfAttributes = function(itemcart) {
            var response = 0;
            var precioatributo = 0;
            var itemcantidad = itemcart.cantidad;
            if (itemcart.atributo != -1 && itemcart.atributos.length > 0) {
                var resfilter = itemcart.atributos.filter(attr => parseInt(attr.detalle_atributo_id) === parseInt(itemcart.atributo));
                console.log(resfilter);
                precioatributo = parseFloat(resfilter[0].atributo_precio);
                response = precioatributo * itemcantidad;
            }
            return parseFloat(response).toFixed(2);
        };*/

        var addcomplementoslista = function (posicioncarrito, detalle_complemento_id) {
            var carrito = JSON.parse(localStorage.carrito);
            var itemcart = carrito[posicioncarrito];
            var findcomplement = null;
            var i_complemento = 0;
            if (itemcart.complementosadded.length > 0) {
                for (const [i, complemento] of itemcart.complementosadded.entries()) {
                    if (parseInt(complemento.detalle_complemento_id) == detalle_complemento_id) {
                        i_complemento = i;
                        break;
                    }
                }
                carrito[posicioncarrito].complementosadded[i_complemento].contador++;
            }

            var preciocomp = getPriceOfComplements(itemcart);
            //var precioattr = getPriceOfAttributes(itemcart);

            $("#subtotal" + posicioncarrito).text("S/" + parseFloat(((itemcart.cantidad * itemcart.precio) + parseFloat(preciocomp))).toFixed(2));
            localStorage.carrito = JSON.stringify(carrito);
            pintadodecomplementos(posicioncarrito);
            actualizarbtnwhatsaap();
        }

        var lesscomplementoslista = function (posicioncarrito, detalle_complemento_id) {
            var carrito = JSON.parse(localStorage.carrito);
            var itemcart = carrito[posicioncarrito];
            var findcomplement = null;
            var i_complemento = 0;

            if (itemcart.complementosadded.length > 0) {
                for (const [i, complemento] of itemcart.complementosadded.entries()) {
                    if (parseInt(complemento.detalle_complemento_id) == detalle_complemento_id) {
                        i_complemento = i;
                        break;
                    }
                }
                if (carrito[posicioncarrito].complementosadded[i_complemento].contador != 0) {
                    carrito[posicioncarrito].complementosadded[i_complemento].contador--;
                }
            }

            var preciocomp = getPriceOfComplements(itemcart);
            //var precioattr = getPriceOfAttributes(itemcart);

            $("#subtotal" + posicioncarrito).text("S/" + parseFloat((parseInt(itemcart.cantidad) * parseFloat(itemcart.precio)) + parseFloat(preciocomp)).toFixed(2));
            localStorage.carrito = JSON.stringify(carrito);
            pintadodecomplementos(posicioncarrito);
            actualizarbtnwhatsaap();
        }

        var addcomplementos = function (posicioncarrito, posicioncomplemento) {
            var carrito = JSON.parse(localStorage.carrito);
            var complemento = carrito[posicioncarrito].complementos[posicioncomplemento];
            var auxcomplemento = complemento;
            var flagencontrado = true;
            if (carrito[posicioncarrito].complementosadded.length > 0) {
                for (const [i, _complemento] of carrito[posicioncarrito].complementosadded.entries()) {
                    if (_complemento.detalle_complemento_id == auxcomplemento.detalle_complemento_id) {

                        flagencontrado = false;
                        carrito[posicioncarrito].complementosadded[i].contador++;
                    }
                }
                if (flagencontrado) {
                    auxcomplemento.contador = 1;
                    carrito[posicioncarrito].complementosadded.push(auxcomplemento);
                }
            } else {
                auxcomplemento.contador = 1;
                carrito[posicioncarrito].complementosadded.push(auxcomplemento);
            }
            var itemcart = carrito[posicioncarrito];
            var preciocomp = 0;
            for (comp of itemcart.complementosadded) {
                preciocomp += comp.detalle_complemento_precio * comp.contador;
            }
            /* var precioattr = 0;
             if (itemcart.atributo != -1) {
                 for (attr of itemcart.atributos) {
                     if (itemcart.atributo == attr.detalle_atributo_id) {
                         precioattr += itemcart.cantidad * attr.atributo_precio;
                     }
                 }
             }*/

            $("#subtotal" + posicioncarrito).text("S/" + parseFloat((itemcart.cantidad * itemcart.precio) + preciocomp).toFixed(2));
            localStorage.carrito = JSON.stringify(carrito);
            pintadodecomplementos(posicioncarrito);
            $("#modalcomplementos").modal("hide");
            actualizarbtnwhatsaap();
        }

        var modalcomplementos = function (posicion) {
            var carrito = JSON.parse(localStorage.carrito);
            var html = "";
            for (const [i, complemento] of carrito[posicion].complementos.entries()) {
                html += `<article onclick="addcomplementos(${posicion},${i})" class="w-100 btn btn-success mt-2 d-flex justify-content-between">
                <span>
                ${complemento.complemento_nombre} 
                </span>
                <span> S/${complemento.detalle_complemento_precio}
                </span>
                </article>`;
            }
            $("#sectioncomplementos").html(html);
            $("#modalcomplementos").modal("show");
        }
        var verificarcontador = function () {
            if (localStorage.contador != null) {
                contador = parseFloat(localStorage.contador);
            } else {
                localStorage.contador = parseFloat(contador);
            }
        }
        var seteodeItems = function (producto, attr) {
            var carrito
            if (localStorage.carrito != null) {
                carrito = JSON.parse(localStorage.carrito);
            } else
                carrito = [];

            var item = {
                "idunico": 0,
                "titulo": "",
                "cantidad": 1,
                "precio": 000,
                "preciodefault": 000,
                "atributo": 0,
                "declaracion": "",
                "img": "",
                "atributos": [],
                "complementos": [],
                "complementosadded": [],
                "activo": true,
                "posicion": 0
            };

            item.idunico = producto.id_producto;
            item.titulo = producto.nombre_producto;

            item.atributo = attr;
            item.atributos = producto.atributos;

            if (item.atributo == -2) {
                item.precio = parseFloat(producto.precio_producto);
                // item.precio = item.preciodefault;
            } else {
                var atributoelegido = item.atributos.find(_atributo => parseInt(_atributo.detalle_atributo_id) === item.atributo);
                item.precio = atributoelegido.atributo_precio;
            }

            item.preciodefault = parseFloat(producto.precio_producto);
            item.activo = true;
            item.img = producto.imagen_producto;
            item.complementos = producto.complementos;
            //item.complementoscomplemento;
            item.posicion = contador;

            var getitem = null;
            if (carrito.length > 0) {
                getitem = carrito.find(_carrito => _carrito.idunico === item.idunico && _carrito.atributo === attr);

            }
            if (getitem != null) {

                var ubicacion = carrito.indexOf(item);
                getitem.cantidad++;
                carrito[ubicacion] = getitem;
                localStorage.carrito = JSON.stringify(carrito);
            } else {
                //item.complementosadded = [];
                item.posicion = contador;
                contador++;
                localStorage.contador = parseInt(contador);
                carrito.push(item);
                localStorage.carrito = JSON.stringify(carrito);
            }
        }

        var urlwhatsapp;

        var condicionparallenadodeLocalStorage = function (result) {
            var producto = result.producto;
            if (localStorage.almacen != producto.almacen_nombre ||
                localStorage.almacen_url_pdf != producto.almacen_url_pdf ||
                localStorage.almacen_horario != producto.almacen_horario ||
                localStorage.almacen_logo != producto.almacen_logo ||
                localStorage.almacen_facebook != producto.almacen_facebook ||
                localStorage.almacen_instagram != producto.almacen_instagram ||
                localStorage.almacen_tiktok != producto.almacen_tiktok ||
                localStorage.almacen_mensaje != producto.almacen_mensaje ||
                localStorage.footer_empresa != result.empresa ||
                localStorage.almacen_rubro != result.empresa.almacen_rubro
            ) {

                localStorage.almacen_mensaje = producto.almacen_mensaje;
                localStorage.footer_empresa = result.empresa;
                localStorage.almacen_facebook = producto.almacen_facebook;
                localStorage.almacen_tiktok = producto.almacen_tiktok;
                localStorage.almacen_instagram = producto.almacen_instagram;

                localStorage.almacen_rubro = producto.almacen_rubro;
                localStorage.almacen_logo = producto.almacen_logo;
                localStorage.almacen = producto.almacen_nombre;
                localStorage.almacen_url_pdf = producto.almacen_url_pdf;
                localStorage.almacen_horario = producto.almacen_horario;
                $("#txthorario").html(localStorage.almacen_horario);
                $("#powerby").html(localStorage.footer_empresa);
                $("#facebook").attr("href", localStorage.almacen_facebook);
                $("#instagram").attr("href", localStorage.almacen_instagram);
                $("#tiktok").attr("href", localStorage.almacen_tiktok);

                $("#logoemp").attr("src", localStorage.almacen_logo);
                $("#nombrealmacen").html(localStorage.almacen);
                $("#rubro").text(localStorage.almacen_rubro);
                $("#pdfurl").attr("href", localStorage.almacen_url_pdf);
                $("#pdfurlarrrow").attr("href", localStorage.almacen_url_pdf);
                //localStorage.carrito = JSON.stringify([]);
            }
            localStorage.whatsapp = `+51${producto.almacen_whatsapp}`;
            localStorage.formasentrega = JSON.stringify(result.entrega);
        }
        var actualizarprecioconformaentrega = function () {
            if (
                $("#nombre").val().trim().length > 0 &&
                $("#direccion").val().trim().length > 0 &&
                $("#slcformaentrega option:selected").val() != -1

            ) {
                var carrito = JSON.parse(localStorage.carrito);
                var preciototal = 0.00;
                var _item;
                for (_item of carrito) {
                    var auxitem = _item;
                    var preciocomp = 0;
                    if (_item.complementosadded.length > 0 && _item.cantidad > 0) {
                        for (item of _item.complementosadded) {
                            preciocomp += item.detalle_complemento_precio * item.contador;
                        }
                    }
                    preciototal += (_item.precio * _item.cantidad) + preciocomp;
                }
                var precioforma = $("#slcformaentrega option:selected").data("price");

                $("#preciototalforma").text(parseFloat((preciototal + precioforma)).toFixed(2));
                $("#verbottom").css("display", "");
                actualizarurlwhatsapp();
            }

            //actualizarurlwhatsapp();
        }

        var llenarformasentregaactl = function (formas) {
            localStorage.formasentrega = JSON.stringify(formas);
            llenarformasentrega();
        }
        var llenarformasentrega = function () {
            var formasentrega = JSON.parse(localStorage.formasentrega);
            var option = `<option value="-1" disabled  selected>Seleccione Forma de Entrega</option>`;
            for (forma of formasentrega) {
                option += `<option data-price="${forma.formaentrega_precio}" value="${forma.detalle_formaentrega_id}">${forma.nombre_formaentrega} | precio : S/${forma.formaentrega_precio}</option>`;
            }
            $("#slcformaentrega").html(option);
        }

        var openimageinmodal = function (event) {
            $("#imgmodal").attr("src", event.target.currentSrc);
            $("#imagemodal").modal("show");
            console.log(event)
        }
    </script>

    <!-- Modal -->

    <div class="modal fade p-0 m-0" id="imagemodal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-md" role="document">
            <div class="modal-content p-1">
               
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" class="float-right">&times;</span>
                    </button>
             
                <img src="" id="imgmodal" alt="">
            </div>
        </div>
    </div>
</body>

</html>